name: Run Automated Tests

on: [push, pull_request] # 每次推送代码或提PR时自动运行

jobs:
  test:
    runs-on: ubuntu-latest # 使用GitHub提供的Linux虚拟机

    steps:
    # 1. 获取你的代码
    - name: Checkout code
      uses: actions/checkout@v3

    # 2. 设置Python环境
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # 3. 安装依赖（确保你项目根目录有 requirements.txt 文件！）
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        pip install pytest pytest-html # 确保安装测试框架和报告插件

    # 4. 运行你的自动化测试，并生成HTML报告
    - name: Run tests with Pytest
      run: pytest test_cases/ -v --html=reports/report.html --self-contained-html

    # 5. （可选但推荐）上传测试报告作为“产物”，供下载查看
    - name: Upload test report
      uses: actions/upload-artifact@v3
      if: always() # 无论测试成功失败都上传报告
      with:
        name: pytest-html-report
        path: reports/report.html
        retention-days: 7
